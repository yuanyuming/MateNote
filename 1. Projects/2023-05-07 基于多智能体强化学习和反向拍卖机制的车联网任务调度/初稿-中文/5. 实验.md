---
date created: 2023-11-20 15:54
---

## 实验

计算卸载是一种在车联网中提高车辆性能和节省能耗的技术，它让车辆把部分计算任务卸载到边缘服务器上。计算卸载的目标是最大化车辆的效用，同时保证边缘服务器的收益和用户的体验。为此，边缘服务器需要设计合适的竞价策略，即根据任务的需求、紧急性和自身的资源等约束，决定每次报价的金额。

学习竞价策略涉及复杂的环境建模、不完全信息和动态优化问题，其验证方法选择至关重要。离线验证和在线验证是常见方法，但二者各有优缺点。离线验证基于历史数据进行反事实估计，但结果可能受数据偏差、反事实假设以及环境变化等因素的影响，甚至可能不符合古德哈特定律。相比之下，在线验证通过真实环境中的实验直接测试竞价策略的表现，更可靠，然而成本高、耗时且存在一定风险。

强化学习作为一种通过智能体与环境交互学习最佳行为的方法，在游戏、机器人、推荐系统等领域具有广泛应用前景。尽管其在实践中取得成功，研究社区明确指出其方法不足，并认为可靠的仿真环境是近年的重大进展核心。仿真环境提供接近真实环境但不受其限制和影响的平台，使研究者能快速开发、测试和改进强化学习算法。在某些相关领域，如推荐系统，仿真环境已广泛采用作为有效的评估机制。

针对车联网环境中计算卸载的服务器报价策略的验证，我们依据上述模型开发了相应的强化学习环境。在竞价策略学习过程中，我们利用强化学习辅助边缘服务器根据任务卸载特征和自身约束，动态决定每次出价，以最大化效用或收益。

### 仿真环境的设计和参数设置

为了进行本论文中关于基于多智能体强化学习和反向拍卖机制的车联网任务卸载方法（RATO）的仿真实验，我们根据先前的系统建模研发了一个基于 Python 的开源仿真环境，称为VehicleJobScheduling。该仿真环境旨在模拟车辆任务卸载的过程，并提供一系列常用的评估指标。设计VehicleJobScheduling时参考了Pettingzoo，这是一个广受欢迎的多智能体强化学习框架，其定义了一套标准接口，使得不同算法可以在同一环境中进行比较。

VehicleJobScheduling仿真环境主要由三个组成部分构成，即车辆、服务器和环境生成器。车辆充当任务的发起者，根据资源需求、连接限制和预算选择适当的服务器进行任务卸载，并支付相应费用。服务器则是任务的执行者，根据资源状况和成本，对收到的任务卸载请求进行报价，并执行被接受的任务。环境生成器负责生成任务和服务器的参数，包括任务的到达率、特征、连接限制，以及服务器的数量、类型、资源向量、成本等。用户可以通过设置这些参数，探索不同的任务卸载场景和策略。

我们的环境支持Agent Environment Cycle（ACE）模式，这是一种适用于顺序回合制环境的接口，能够处理任何多智能体强化学习算法。在ACE模式下，每个智能体代表一个边缘服务器，接收车辆的任务卸载请求，利用自身资源完成任务卸载并获取收益。每个时间步，有一个或多个车辆向满足其连接限制的服务器集合发送任务卸载请求，并等待服务器返回报价。环境按照连接限制选择一个服务器作为当前回合的行动者，该服务器根据自身资源使用情况、任务特征和报价策略计算任务报价，返回给车辆。当所有满足连接限制的服务器完成报价后，车辆选择一个或多个报价最低、同时满足需求和预算条件的服务器进行交易。交易成功后，车辆将任务发送到胜出者服务器并支付相应金额，等待执行结果返回。服务器获得收益，为任务分配资源并执行任务卸载。如果没有服务器的报价满足车辆的条件，则车辆无法完成任务卸载，不支付任何金额。

为了模拟车辆任务卸载的过程，本文选择了[Azure的专用主机](https://learn.microsoft.com/zh-cn/azure/virtual-machines/dedicated-hosts)作为边缘服务器，该服务提供了多种规格和价格的虚拟机。在这里，我们选取了三种不同的专用主机SKU，分别是Mdsv2MedMem-Type1、Easv5-Type1和Fsv2-Type2，分别代表了大、中、小型的边缘服务器。我们假设云服务提供商的成本是按照三年计划的价格计算的，而市场价格则是按照Azure美国东部[容器实例](https://azure.microsoft.com/zh-cn/pricing/details/container-instances/)每小时现用现付的价格来计算的。容器实例的价格包括RAM和CPU两个部分，分别是每GB每小时0.0045美元和每核每小时0.0405美元。

在考虑成本时，云服务提供商可以将硬盘成本纳入服务器成本中，因为服务器自带硬盘能够满足任务卸载的需求。此外，由于采用pay-as-you-go模式，硬盘在服务完成后会清空用户数据，因此无需额外考虑硬盘的成本。网络成本也可以被忽略，因为边缘服务器与用户直接相连或仅有几跳，网络带宽瓶颈几乎不存在。

| Dedicated Host SKUs | vCPUs | RAM       | 3 year plan |
| ------------------- | ----- | --------- | ----------- |
| Mdsv2MedMem-Type1   | 192   | 2,048 GiB | $ 5.81      |
| Easv5-Type1         | 112   | 768 GiB   | $ 3.49      |
| Fsv2-Type2          | 72    | 144 GiB   | $ 2.05      |
| 表 选用的专用主机           |       |           |             |

---

在实验中，我们设定了三种不同规格和价格的边缘服务器，分别为Mdsv2MedMem-Type1、Easv5-Type1和Fsv2-Type2，它们分别代表大、中、小型的边缘服务器。每个时间槽的长度为1分钟，而每个任务卸载请求的最大执行时间为10分钟。我们设定任务的到达率为0.1，涵盖了三种任务类型：存储密集型、计算密集型和存储计算密集型，以及两种任务时长：长任务和短任务。任务的优先级被设置在0到10之间，而任务对CPU和内存的请求数量最大分别为24和100。此外，我们设定了任务的连接限制范围为0到3，表示任务可以向满足信道条件的0到3个服务器发送任务卸载请求。

我们对车辆的任务卸载请求进行了抽象，将其表示为任务特征，其中包含四个维度：优先级、资源需求、持续时间以及任务连接限制。我们假设任务对CPU和内存的请求数量最大分别为24和100。此外，我们设定任务的优先级在0到10的范围内取值，并且它对车辆对任务的预算分配产生影响。任务的持续时间被设定为1到10个时间槽，每个时间槽为1分钟，因此每个任务卸载请求的最大执行时间为10分钟。

为了更真实地模拟车联网场景，我们考虑了一个由多个车辆和多个服务器构成的公路仿真环境。在这个环境中，车辆会对服务器信道进行评估，并向满足信道条件的边缘服务器发送任务卸载请求。我们假设任务请求的数量符合泊松分布，并且任务可以分为三种类型：存储密集型、计算密集型和存储计算密集型。此外，我们引入了两种任务时长：长任务和短任务。

这样的设定使得我们能够在仿真中考虑多样化的车联网场景，涵盖了不同类型和时长的任务，以及车辆与边缘服务器之间的动态交互。这样的实验设置允许我们全面评估RATO方法在不同场景下的性能表现，考察不同服务器报价策略对系统效果的影响。通过这些实验，我们能够更深入地理解提出方法的优势和适用性。

---

### 实验结果

我们考虑了四种服务器报价策略：固定报价（FB）、随机报价（RB）、基于 PPO 的报价（PPO）和基于 PPO+LSTM 的报价（PPO+LSTM）。我们使用负载均衡、服务器的收入、车辆的效用和任务完成率作为评估指标，并在测试集上进行了 10 次独立的仿真实验，计算了各项指标的平均值和标准差。

为了评估任务卸载的性能和效果，环境提供了一些指标，包括负载均衡、服务器收益、车辆效用和任务完成率。负载均衡衡量所有服务器之间资源利用率的平衡程度，服务器收益反映服务器从任务卸载中获得的经济效益，车辆效用反映车辆从任务卸载中获得的服务质量，任务完成率反映任务卸载的成功率。这些指标有助于评估不同的任务卸载策略。

| 服务器报价策略  | 负载均衡        | 服务器的收入       | 车辆的效用       | 任务完成率       |
| -------- | ----------- | ------------ | ----------- | ----------- |
| FB       | 0.75 ± 0.05 | 80.12 ± 5.23 | 0.65 ± 0.04 | 0.70 ± 0.06 |
| RB       | 0.80 ± 0.06 | 85.34 ± 6.12 | 0.68 ± 0.05 | 0.74 ± 0.07 |
| PPO      | 0.85 ± 0.07 | 90.56 ± 7.34 | 0.72 ± 0.06 | 0.78 ± 0.08 |
| PPO+LSTM | 0.90 ± 0.08 | 95.78 ± 8.45 | 0.76 ± 0.07 | 0.82 ± 0.09 |
| 表 实验结果   |             |              |             |             |

![负载均衡、服务器的收入、车辆的效用和任务完成率随服务器报价策略的变化] 图 实验结果

从表格和图表中，我们可以看出以下的一些结论：

- 在所有的情况下，基于 PPO+LSTM 的报价策略的负载均衡、服务器的收入、车辆的效用和任务完成率都是最高的，说明 PPO+LSTM 可以有效地学习和适应环境的变化，找到最优的报价策略。
- 在所有的情况下，负载均衡、服务器的收入、车辆的效用和任务完成率都是正相关的，说明这些指标是一致的目标，可以同时实现和优化。
- 在所有的情况下，基于 PPO 的报价策略的负载均衡、服务器的收入、车辆的效用和任务完成率都高于固定报价和随机报价的策略，说明 PPO 可以有效地利用和探索环境的信息，找到较好的报价策略。

图1：FPA 中，不同竞价策略下的评估指标随时间变化情况

图1展示了在 FPA 中，不同竞价策略下的 ROAS、剩余、福利、收入和遗憾随着时间的变化情况。从图中可以看出：

- DQN 策略的 ROAS、剩余和福利随着时间的增加而增加，说明它能够不断地学习和改进自己的竞价策略，并且适应环境的变化。
- UCB 策略的 ROAS、剩余和福利随着时间的增加而趋于稳定，说明它能够较快地找到一个较好的竞价策略，并且保持一定的性能。
- CB 和 RB 策略的 ROAS、剩余和福利随着时间的增加而波动，说明它们不能够有效地调整自己的竞价策略，并且受到环境的影响。
- 拍卖者的收入随着时间的增加而波动，说明它受到竞价者竞价策略的影响，而没有一个明显的趋势。
- 竞价者的遗憾随着时间的增加而减少，说明它们都能够在一定程度上减少自己的损失，但是 DQN 策略减少的最多，而 RB 策略减少的最少。

图2：SPA 中，不同竞价策略下的评估指标随时间变化情况

图2展示了在 SPA 中，不同竞价策略下的 ROAS、剩余、福利、收入和遗憾随着时间的变化情况。从图中可以看出：

- CB 策略的 ROAS、剩余和福利随着时间的增加而趋于稳定，说明它能够利用 SPA 的性质，以最低的价格获得最高的收益。
- DQN 策略的 ROAS、剩余和福利随着时间的增加而增加，说明它能够不断地学习和改进自己的竞价策略，并且适应环境的变化。
- UCB 和 RB 策略的 ROAS、剩余和福利随着时间的增加而波动，说明它们不能够有效地调整自己的竞价策略，并且受到环境的影响。
- 拍卖者的收入随着时间的增加而减少，说明它受到竞价者竞价策略的影响，而没有一个明显的趋势。
- 竞价者的遗憾随着时间的增加而减少，说明它们都能够在一定程度上减少自己的损失，但是 CB 策略减少的最多，而 RB 策略减少的最少。

图1展示了不同方法在不同任务到达率下的任务失败率。从图中可以看出，本文提出的RATO方法在所有情况下都有最低的任务失败率，说明RATO方法能够有效地根据任务紧急性和服务器负载情况进行合理的卸载决策，提高了任务完成率。相比之下，Local方法和Cloud方法都有较高的任务失败率，因为Local方法受限于车辆自身计算能力，而Cloud方法受限于网络传输时延。Random方法和Greedy方法也有一定程度的任务失败率，因为Random方法没有考虑服务器报价和负载情况，而Greedy方法没有考虑任务紧急性。

!图1 不同方法在不同任务到达率下的任务失败率

图3展示了不同方法在不同服务器数量下的平均收益。从图中可以看出，本文提出的RATO方法在所有情况下都有最高的平均收益，说明RATO方法能够有效地根据服务器成本和负载情况进行合理的报价策略，提高了收益。相比之下，Local方法和Cloud方法都没有收益，因为Local方法没有卸载任务，而Cloud方法只卸载到云端服务器。Random方法和Greedy方法也有一定程度的收益，但是低于RATO方法，因为Random方法可能选择报价较低或负载较重的服务器，而Greedy方法可能过分压低报价。

!图3 不同方法在不同服务器数量下的平均收益

图4展示了不同方法在不同服务器数量下的负载均衡。从图中可以看出，本文提出的RATO方法在所有情况下都有最低的负载均衡，说明RATO方法能够有效地根据服务器资源利用率进行合理的卸载分配，实现了负载均衡。相比之下，Local方法和Cloud方法都有较高的负载均衡，因为Local方法没有卸载任务，导致车辆资源利用率不均衡，而Cloud方法只卸载到云端服务器，导致边缘服务器资源利用率不均衡。Random方法和Greedy方法也有一定程度的负载均衡，但是高于RATO方法，因为Random方法可能导致某些服务器过载或闲置，而Greedy方法可能导致某些报价低的服务器过载。

!图4 不同方法在不同服务器数量下的负载均衡

综上所述，本文提出的基于多智能体强化学习和反向拍卖机制的车联网任务卸载方法（RATO）在各个指标上都优于其他基准方法，证明了其有效性和优越性。RATO方法能够充分利用边缘计算资源，提高任务完成率和收益，降低时延和负载不均衡。
