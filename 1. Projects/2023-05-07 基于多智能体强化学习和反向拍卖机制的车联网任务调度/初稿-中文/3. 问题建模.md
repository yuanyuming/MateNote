
- 问题建模
  - 建立车联网中的任务调度模型
  - 定义任务、车辆、边缘服务器、资源、效用等概念
  - 描述任务调度的目标和约束条件。
- 介绍车联网用途
- 介绍本节内容
![[Pasted image 20230902100123.png]]
车联网任务调度示意图



- 系统架构和模型建立
- 问题建立

## MEC 车联网资源卸载架构和系统模型

### MEC 车联网资源卸载架构

MEC 车联网任务卸载是指将车辆上的计算密集或延迟敏感的任务转移到边缘服务器或云服务器上进行处理，以节省车辆的能量消耗和提高任务的执行效率。不同的卸载目标和场景可能需要不同的卸载策略和方法。 车辆与车辆之间的卸载, 可以利用车辆的闲置资源提供服务, 但是任务的卸载主要取决于用户本身的意愿, 其次才是车辆的资源情况, 而一般情况下为了保证用户的体验,我们无法替用户做出决定, 所以车辆与车辆之间的任务卸载不适用于自动调度的场景. 车辆与云服务器之间的任务卸载,利用云服务器强大的计算能力和存储空间,可以处理一些数据量大或计算复杂度高的任务, 但是由于车辆与云服务器之间的延迟较大, 仅适合一些对延迟要求不高的任务,这些任务特征比较明显,其调度可以由车辆自身的调度进行决定. 本次研究的车联网资源卸载模型主要面向车辆与边缘服务之间的资源卸载, 车辆将任务卸载到距离较近的边缘服务器进行计算, 这种方式可以减少任务执行延迟和汽车的能量消耗, 适用于对计算延迟要求较高并且对算力要求较高的任务.例如 自动驾驶,实时控制等应用场景.

由于卸载到边缘服务器所需要实时性较高, 资源需求也较高, 并且服务器的服务意愿也较强, 因此可以使用无人监督的机制来进行资源分配, 提升用户体验和降低服务器管理成本. 为简化本次车联网资源卸载的模型, 本文只考虑车辆向边缘服务器卸载这一种车联网资源卸载范式. 在这种架构中. 车辆通过无线网络与公路边上的边缘服务器进行资源卸载.车辆作为资源请求的发起方, 将通过无线网络与其连接范围内的边缘服务器建立连接, 而边缘服务器固定在道路两旁, 通过评估车辆连接状态情况确定能否接受资源卸载. 当提出卸载请求的车辆收集到边缘服务器连接状态后, 向可接受资源卸载的服务器提交任务请求. 接收到任务请求的边缘服务器根据自身资源利用情况向提出请求的车辆进行报价. 车辆在接受到各个服务器的报价之后决定卸载的边缘服务器和支付的价格. 随后车辆对任务进行卸载, 在任务执行完成后, 车辆向边缘服务器进行支付, 整个车联网资源卸载过程结束.

### 系统模型

为了研究车联网任务调度问题, 我们需要根据上述的MEC车联网资源卸载架构对整个车联网任务调度系统进行建模. 建模内容包含任务生成模型, 边缘服务器集群模型和反向拍卖模型.我们建立了一个任务在每一个时刻数量泊松分布, 资源请求符合双峰分布[^双峰分布]的任务生成模型. 共有$n$ 个在路边并具有无线连接能力的边缘服务器模型和一个反向拍卖的模型. 系统首先由任务生成模型生成这一时间段所需要处理的任务, 任务的数量和资源请求符合相应的分布, 随后根据连接限制条件生成任务执行的服务器限制. 随后系统将生成任务集合的任务派发服务器集群模型, 服务器集群模型将任务请求信息发送到满足服务器限制的边缘服务器. 边缘服务器根据任务相关信息和自身资源利用情况向反向拍卖模型发送自身对任务的报价, 反向拍卖模型在收集服务器返回的报价后决定卸载服务器和支付, 车辆在接受到支付信息后,与自身预算进行比较,如果超出预算,则终止任务卸载,由车辆自身执行任务. 最后, 如果车辆决定向服务器进行任务卸载, 则由边缘服务器执行任务, 任务执行完毕后边缘服务器得到相应的支付.

[^双峰分布]: <https://en.wikipedia.org/wiki/Multimodal_distribution>, 等待补充

#### 任务模型

在车联网资源卸载的过程中，车辆可能向边缘服务器提交各种不同的任务请求，例如计算密集、I/O密集或者两者兼有，不同的任务持续的时间有不同的特征。为了简化模型，我们不再对车辆进行单独建模，因为车辆所提交的任务与车辆本身的性质无关，只与任务本身的属性有关。因此，我们选择对任务的关键信息进行建模。我们用 $task_i=(C_i,A_i)$ 来表示一个任务，其中 $C_i=(p_i,r_i,d_i)$ 是任务的特征，$A_i=(n_i,t_i,a_i,b_i,f_i)$ 是任务的属性。任务的特征和属性的含义如下表所示：

任务的优先级 $p_i$，反映了任务的紧急程度和重要性，它是一个介于0和1之间的实数，越接近1表示越高的优先级；任务的资源需求 $r_i$，表示任务执行所需要的资源，例如计算资源和存储资源，它是一个二元组 $(c_i,s_i)$，其中 $c_i$ 是计算资源需求，$s_i$ 是存储资源需求；任务的持续时间 $d_i$，表示任务从开始到结束所花费的时间；任务的编号 $n_i$，用于区分不同的任务；任务的发起时间 $t_i$，表示任务从车辆发送到边缘服务器的时间点；任务的执行服务器限制 $a_i$，表示任务可以从车辆发送到那些服务器，它是一个服务器的集合，包含了所有能够满足任务连接需求的服务器；任务的预算 $b_i$，表示车辆愿意为任务执行支付的最高费用；最后，任务的最终支付 $f_i$，表示车辆实际为任务执行支付的费用。

我们将所有车辆提交的任务组成一个列表 $\mathcal{T}=\{T_1,T_2,\dots,T_N\}$，其中 $N$ 是总的时间步数, $T_i​$ 是第 i 个时间步中车辆发起的所有任务的集合。为了简化问题，我们假设在每个时间步 $i$ 开始时，只有一个任务参与拍卖，然后根据拍卖结果分配执行服务器。当 $T_i$ 中的所有任务都参与过拍卖后，环境进入下一个时间步 $i+1$，继续进行拍卖, 直到最后一个时间步$N$。我们的目标是设计一个任务报价策略，使得每个边缘服务器能够在满足任务的执行服务器限制 $a_i$ 和预算 $b_i$ 的前提下，最大化每个边缘服务器的收益 $r_s = \sum_{i=1}^N p_{i,s} - c_{i,s}$。其中 $r_s$ 是边缘服务器s的收益，$p_{i,s}$ 是第i个时间步中结束任务的支付，$c_{i,s}$ 是服务器每回合的维护成本。

我们假设每个服务器都可以与其他服务器进行通信，并且可以接受来自外部或内部的任务请求。我们用 $\mathcal{T}=\{T_1,T_2,\dots,T_N\}$ 来表示所有车辆提交的任务列表，其中 $N$ 是总的时间步数。我们假设列表 $\mathcal{T}$ 按照任务发起时间 $t_i$ 的升序排列，即 $t_1 \leq t_2 \leq \dots \leq t_n$。


#### 服务器集群模型

车联网（Vehicular Ad Hoc Network，简称 VANET）是一种由移动车辆和固定基础设施组成的自组织网络，它可以提供各种智能交通服务和应用。车联网中的车辆通常具有有限的计算能力、存储空间和电池寿命，因此在执行一些计算密集、数据密集或时延敏感的任务时，可能无法满足性能和质量要求。为了解决这个问题，一种可行的方法是将车辆的任务卸载到边缘服务器上执行。

边缘服务器（Edge Server）是一种部署在网络边缘的服务器，它可以提供近距离的计算、存储和通信服务，从而降低网络延迟、节省带宽和提高用户体验。边缘服务器在车联网任务卸载中的作用是为车辆提供高效、可靠和安全的任务执行环境，使得车辆可以将一些不适合在本地执行的任务迁移到边缘服务器上，从而节省车辆的资源消耗、提高任务的执行效率和质量、增加车辆的服务收益。

一个服务器集群是由若干个服务器组成的，每个服务器可以执行一些任务，并且有一定的资源限制和收益。服务器集群在车联网任务卸载中的作用是为车辆提供更多的选择和灵活性，使得车辆可以根据自己的需求和偏好，在不同的服务器之间进行任务分配、协调和迁移，从而优化资源利用率、平衡负载压力、增强容错能力。

我们用 $S_k=(A_k,S_k)$ 来表示第 $k$ 个服务器，其中：
- $A_k$：服务器属性（Attribute），是一个元组，表示服务器的固定特征，它包括：
    - 服务器编号 $n_k$，用于唯一标识该服务器
    - 服务器资源 $r_k$，表示该服务器最大资源使用限制
    - 服务器成本 $c_k$，表示服务器维护的成本
- $S_k$：服务器状态（State），是一个元组，表示服务器的动态变化，它包括：
    - 服务器负载 $l_k$，表示该服务器当前的资源使用情况
    - 正在运行的任务集合 $R_k$，表示该服务器正在执行的任务

我们用 $S=\{S_1, S_2, ..., S_n\}$ 来表示一个包含 $n$ 个服务器的集群中所有的服务器。我们用 $C=(S,A)$ 来表示一个集群及其属性，其中：
- $A$：集群属性（Attribute），是一个元组，表示集群的固定特征，它包括：
    - 当前时间 $t$，表示当前的系统时间
    - 资源请求最大限制 $m$，表示集群能够接受的资源请求的最大值
    - 资源请求最大时间限制 $t_m$，表示集群能够接受的资源请求的最大持续时间




### 问题定义

在车联网环境下，车辆决定将任务卸载到边缘服务器，于是向拍卖商（服务提供商）发送任务请求。拍卖商通过获取与车辆相联的基站可以评估当前可以连接到的边缘服务器，边缘服务器可以通过路由的方式访问，只要能达到低延迟就可以。拍卖商将任务请求传递给各个边缘服务器，边缘服务器在接收到请求后根据服务器当前的状态给与一个报价返回拍卖商，拍卖商在接收到所有的报价之后选择报价最低的服务器进行卸载并向用户收取相应报价和向边缘服务器支付其报价。这个过程完成后将会正式开始任务卸载。任务卸载结束后,由卸载车辆向被卸载服务器支付.

- 问题的输入是一个时间段内由需要卸载的车辆产生的任务集合 $\mathcal{T}=\{T_1,T_2,\dots,T_N\}$，其中 $N$ 是总的时间步数，每个时间步 $T_i=\{task_1,task_2,...,task_m\}$ 包含了 $m$ 个任务，每个任务 $task_j=(n_j,p_j,r_j,d_j,t_j,a_j)$ 包含了编号、优先级、资源需求、持续时间、发起时间、执行服务器限制等属性。
- 问题的输出是一个任务卸载方案集合 $\mathcal{P}=\{(S_1,p_1),(S_2,p_2),\dots,(S_N,p_N)\}$，其中每个元组 $(S_i,p_i)$ 表示第 $i$ 个任务被卸载到的边缘服务器 $S_i$ 和车辆支付给拍卖商的价格 $p_i$。
- 问题的目标是在满足每个任务的能耗、延迟和执行服务器限制的前提下，最大化每个边缘服务器的收益 $\sum_{i=1}^n f_i - \sum_{i=1}^n rR_iD_i$。其中 $f_i$ 是任务 $task_i$ 的最终支付，$r$ 是单位资源成本，$R_i$ 是任务 $task_i$ 的实际执行时间，$D_i$ 是任务 $task_i$ 的实际执行服务器。
- 问题的约束是：
  - 车辆只能将任务卸载到一个边缘服务器上；
  - 边缘服务器必须在任务执行时有足够的资源来执行任务；
  - 边缘服务器必须满足任务的执行服务器限制 $a_i$；
  - 任务分配必须在任务发起的时间间隙完成，不允许排队；
  - 车辆必须在任务最终支付 $f_i$ 不超过预算 $b_i$ 的情况下接受拍卖结果。

## 优化目标和约束条件

基于以上定义，我们可以把车联网中的任务调度问题建模为一个优化问题：

$$
\begin{aligned}
& \max \sum_{i=1}^n U_i \\
& \text{s.t.} \\
& C1:\text{每个任务只能在一个设备上执行} \\
& C2:\text{每个设备上执行的任务不能超过其可用资源} \\
& C3:\text{每个卸载任务必须在其所选边缘服务器的覆盖范围内执行} \\
& C4:\text{每个卸载任务的最终支付不能超过其效用}\\
\end{aligned}

$$

其中，$\sum_{i=1}^n U_i$ 是社会福利，表示所有任务的效用之和，C 1 到 C 4 是约束条件。


---

在移动边缘计算中, 车联网是一个非常重要的应用场景，车辆需要在行驶过程中执行不同的计算任务，例如语音识别、路线规划、计算机视觉、机器学习、增强现实等。这些任务对于计算资源和存储资源的需求各不相同，而车辆自身的计算能力和电池容量是有限的。因此，车辆可以选择将部分任务卸载到边缘服务器上进行处理，以节省能耗和提高性能。然而，由于车辆和边缘服务器之间的网络连接是不稳定的，而且边缘服务器的资源也是有限的，因而如何高效地进行任务卸载和资源分配成为一个关键问题。


在本次车联网任务调度的问题建模中, 我们假设一个由$m$个卖家$\mathcal S=\{\mathbf s_1,\dots,\mathbf  s_m\}$和$n$个买家$\mathcal B=\{\mathbf b_1,\dots,\mathbf b_n\}$组成的车联网卸载模型. 卖家为能够提供任务卸载的服务器, 表示为$\mathbf s_i =(\mathbf r_i,c_i)$. 每个卖家 $\mathbf s_i$ 有资源向量 $\mathbf r_i=(r_{j,1},\dots,r_{j,d})$ 和成本 $c_i$，其中, $d$表示服务器总的资源种类, $\mathbf r_{j,k}$表示服务器$j$拥有第$k$种资源的数量，$c_i$ 表示单位时间的维护成本。 买家为需要任务卸载的车辆提交的一次任务请求,表示为 $\mathbf b_j=(\theta_j,\psi_j)$, 其中, $\theta_j=(\mathbf f_j,\mathbf \sigma_j)$表示一个任务,$\mathbf f_j=(l_j,r_j,d_j,\tau_j)$ 是任务的执行特征, $\mathbf \sigma_j=(\sigma_{j,1},\dots,\sigma_{j,m})$ 是任务的执行服务器限制向量表示任务$\theta_j$是否可以在服务器$\mathbf s_i$上执行。 $l_j$表示任务的优先级， $\mathbf r_j=(r_{j,1},\dots,r_{j,d})$表示任务的资源需求, $r_{i,k}$表示任务$i$对第$k$种资源的需求数量； $d_j$表示任务的持续时间； $\tau_j$表示任务的到达时间。$\psi_j$为买家$b_j$对$\theta_j$的预算.

在时间步$t$时, 我们用 $\mathcal U_t​$表示车辆在第$t$个时间步提交的所有任务, 任务序号按照时间非降序排列, 假设$\mathcal U_t$中的任务, 每次按照任务到达顺序取一个任务$\theta_j\in \mathcal U_t$进行拍卖, 则本次拍卖中, 买家为$b_j$表示发起本次任务请求的车辆, 卖家为$\mathcal S_j=  \{\mathbf s_i|\forall \mathbf s_i \in \mathcal S, \sigma_{j,i}=1\}$, 表示能够满足执行服务器限制向量的服务器集合.

拍卖开始时, 买家$\mathbf b_j$将$\theta_j$的特征$\mathbf f_j$发送到参加拍卖的所有卖家$\mathcal S_j$, 卖家根据自身状态和接收的任务特征返回报价$\mathcal Q_j = \{q_{j,i}|\forall \mathbf s_i\in \mathcal S_j\}$, $\mathcal Q_j$表示服务器对$\theta_j$的报价集合,$q_{j,i}$表示卖家服务器$\mathbf s_i$对任务$\theta_j$的报价. 随后产生拍卖结果, 服务器分配向量$\mathbf x_{j}=(x_{j,1},\dots,x_{j,m})$ ,支付 $p_{j}=\min(q_j)$. 若$x_{j,i}=1$表示分配到$\mathbf s_i$, 若$x_{j,i}=0$, 表示未分配到$\mathbf s_i$. 买家支付并开始任务卸载。当$\mathcal U_t$中所有任务都进行过拍卖后, 进入下一个时间步$t+1$, 当所有时间步都完成后，拍卖过程结束。

为了描述任务卸载过程中的资源使用情况，我们需要对任务和服务器的资源在执行时的占用进行建模。我们假设任务$\theta_j$在时间$t$对资源的占用为
$$
r_{\theta_j}(t)=(r_{{\theta_j},1}(t),\dots,r_{{\theta_j},d}(t))
$$
，其中$r_{{\theta_j},k}(t)$表示任务$\theta_i$在时间$t$对第$k$种资源的占用量。
$$
r_{{\theta_j},k}(t)=\begin{cases}
r_{j,k}&\text{if }\tau_j \leq t < \tau_j+d_j \\
0,&\text{otherwise}
\end{cases}
$$
类似地，我们假设卖家服务器$\mathbf s_i$在时间$t$的可用资源为
$$r_{\mathbf s_i}(t)=(r_{{\mathbf s_i},1}(t),\dots,r_{{\mathbf s_i},d}(t))$$
，其中$r_{{\mathbf s_i},k}(t)$表示服务器$\mathbf s_j$在时间$t$拥有第$k$种资源的剩余量。我们假设任务$\theta_j$在分配到服务器$\mathbf s_i$后，会在$\tau_j$立即开始执行，$\tau_j+d_j$时间内完成，即从$\tau_j$到$\tau_j+d_j-1$的时间段内，任务$i$会占用服务器$k$的资源，而在$\tau_j+d_j$时刻释放资源。因此，我们可以定义对于$\theta_j$的服务状态变量$s_{i,k}(t)$为：

$$
s_{j,i}(t)=\begin{cases}
1, & \text{if }  x_{j,i}=1 \text{ and } \tau_j \leq t < \tau_j+d_j\\
0, & \text{otherwise}
\end{cases}
$$

其中$x_{j,i}$表示任务$\theta_i$是否分配到服务器$\mathbf s_i$。服务状态变量$s_{j,i}(t)$表示任务$\theta i$在时间$t$是否占用服务器$\mathbf s_i$的资源。

根据服务状态变量，我们可以计算任务$\theta i$在时间$t$对服务器$\mathbf s_i$的资源占用量为：
$$r_{j,i}(t)=s_{j,i}(t)\cdot r_{\theta_j}(t)$$

由此，我们可以得到服务器$\mathbf s_i$在时间$t$的可用资源为：
$$r_{s_i}(t)=\mathbf r_i-\sum_{i=1}^{|\mathcal U_t|} r_{j,i}(t)$$其中$|\mathcal U_t|$表示$t$时间内任务总数，$\mathbf r_i$表示服务器$\mathbf s_i$的总资源量。服务器$j$在时间$t$的可用资源$r_i(t)$表示服务器$j​$在时间$t​$可以接受新的任务卸载请求的资源余量。

服务器$j$在接收到任务卸载时会获得收益, 则边缘服务器$\mathbf s_i$在总时间步$T$到达时的收益为:
$$R_i = \sum_{t=1}^T (p_{t,i} - c_{i})$$
其中, $p_{t,i}=\sum_{i=1}^{|\mathcal U_t|} p_{i} x_{j,i}$ 是第$t$个时间步内得到的总支付，$p_{j}$为任务$\theta_j$的支付，$c_{i}$ 是服务器每回合的维护成本。


我们的目标是，在总时间步$T$到达时，对于所有买家$\mathbf b$，卖家$\mathbf s$，设计服务器的任务报价策略，使得每个边缘服务器能够在满足任务预算和服务器执行限制的前提下，最大化卖家整体收益$R=\sum^{m}_{i=1} R_i$.

基于以上定义，我们可以把车联网中的任务调度问题建模为一个优化问题：

$$

\begin{aligned}

&Objective: \max_{q_j} R= \sum^m_{i=1} \sum_{t=1}^T (\sum_{j=1}^{|\mathcal U_t|} p_{j} x_{j,i}- c_j)\\
&\\

&\text{s.t.}\ \ \begin{aligned}

& C1:\sum_{j=1}^n x_{j,i}\sigma_{j,i} \le 1, \forall i \in \mathbf b, j \in \mathbf s \\
& C2:p_j \sum_{i=1}^m  x_{j,i}\sigma_{j,i} \leq b_j, \forall i \in \mathbf b, j \in \mathbf s \\
& C3: r_{s_i}(t)\ge 0, \forall i \in \mathbf b, s_i \in \mathbf s,  t \in [0, T]\\
\end{aligned}

\end{aligned}
$$

限制条件的含义如下：
- C1:表示每个任务只能卸载到$a_j$中的一个边缘服务器上；
- C2:表示每个卸载任务的最终支付不能超过其预算$b_j$。
- C3:表示每个边缘服务器在任意时间点可用资源$r_k(t)\ge 0$

以上就是本文对车联网资源卸载问题的系统模型和问题建模。在下一章中，我们将详细介绍本文提出的基于多智能体强化学习和反向拍卖的任务调度算法.

---
- 车联网任务调度问题：车辆在行驶中需要执行不同的计算任务，可以选择卸载到边缘服务器上
- 问题建模：$m$个卖家（服务器），$n$个买家（车辆），每个卖家有资源向量$\mathbf r_i$和成本$c_i$，每个买家有任务向量$\mathbf f_j$和预算$\psi_j$
- 任务特征：优先级$l_j$，资源需求$\mathbf r_j$，持续时间$d_j$，到达时间$\tau_j$
- 任务执行限制：$\mathbf \sigma_j$表示任务是否可以在某个服务器上执行
- 拍卖过程：每个时间步$t$，每个任务$\theta_j\in \mathcal U_t$进行拍卖，买家发送任务特征$\mathbf f_j$，卖家返回报价$q_{j,i}$，产生拍卖结果$x_{j,i}$和支付$p_j$
- 服务状态变量：$s_{j,i}(t)$表示任务在时间$t$是否占用服务器的资源
- 资源占用量：$r_{j,i}(t)=s_{j,i}(t)\cdot r_{\theta_j}(t)$表示任务对服务器的资源占用量
- 可用资源：$r_{s_i}(t)=\mathbf r_i-\sum_{i=1}^{|\mathcal U_t|} r_{j,i}(t)$表示服务器的可用资源
- 收益：$R_i = \sum_{t=1}^T (p_{t,i} - c_{i})$表示服务器的收益
- 目标：最大化卖家整体收益$R=\sum^{m}_{i=1} R_i$
- 约束：C1:每个任务只能卸载到一个服务器；C2:每个任务的支付不能超过预算；C3:每个服务器的可用资源不能为负

---

问题的建模和方法的原理

本文考虑了一个由多个车辆和多个服务器构成的车联网环境，如图 1 所示。车辆是任务的发起者，它们需要根据自己的资源需求、连接限制和预算，选择合适的服务器进行任务卸载，并支付相应的费用。服务器是任务的执行者，它们需要根据自己的资源状况和成本，对收到的任务卸载请求进行报价，并执行被接受的任务。我们假设车辆和服务器之间的通信是无线的，且受到信道条件的影响。我们假设车辆和服务器之间的任务卸载是通过反向拍卖的方式进行的，即车辆向满足其连接限制的服务器集合发送任务卸载请求，并等待服务器返回报价。我们假设车辆和服务器都是自利的，即它们的目标是最大化自己的效用或者收益。
![车联网任务卸载的示意图]
图 1 车联网任务卸载的示意图。车辆和服务器之间的通信是无线的，且受到信道条件的影响。车辆和服务器之间的任务卸载是通过反向拍卖的方式进行的，即车辆向满足其连接限制的服务器集合发送任务卸载请求，并等待服务器返回报价。
为了形式化地描述车联网任务卸载的问题，我们首先定义一些符号和变量。我们用 $N$ 表示车辆的数量，用 $M$ 表示服务器的数量。我们用 $V = {v_1, v_2, ..., v_N}$ 表示车辆的集合，用 $S = {s_1, s_2, ..., s_M}$ 表示服务器的集合。我们用 $T = {t_1, t_2, ..., t_T}$ 表示时间的集合，其中 $T$ 是仿真的总时间槽，每个时间槽的长度为 $\Delta t$。我们用 $R = {r_1, r_2, ..., r_R}$ 表示任务的集合，其中 $R$ 是仿真的总任务数。我们用 $r_i^v$ 表示第 $i$ 个任务的发起者，即车辆 $v_i$。我们用 $r_i^s$ 表示第 $i$ 个任务的执行者，即服务器 $s_i$。我们用 $r_i^t$ 表示第 $i$ 个任务的到达时间，即时间槽 $t_i$。我们用 $r_i^d$ 表示第 $i$ 个任务的持续时间，即时间槽 $d_i$。我们用 $r_i^p$ 表示第 $i$ 个任务的优先级，即一个介于 0 到 10 之间的整数。我们用 $r_i^c$ 表示第 $i$ 个任务的连接限制，即一个介于 0 到 3 之间的整数。我们用 $r_i^b$ 表示第 $i$ 个任务的预算，即车辆 $v_i$ 愿意为任务 $r_i$ 支付的最大金额。我们用 $(s_{j,c},s_{j,m})$ 表示服务器 $s_j$ 的资源向量，即一个二元组 $(s_{j,c},s_{j,m})$，其中 $s_{j,c}$ 表示服务器 $s_j$ 的 CPU 总量，$s_{j,m}$ 表示服务器 $s_j$ 的内存总量。我们用 $(s_{j,c}^u,s_{j,m}^u)$ 表示服务器 $s_j$ 的资源利用率，即一个二元组 $(s_{j,c}^u,s_{j,m}^u)$，其中 $s_{j,c}^u$ 表示服务器 $s_j$ 的 CPU 利用率，$s_{j,m}^u$ 表示服务器 $s_j$ 的内存利用率。我们用 $(s_{j,c}^a,s_{j,m}^a)$ 表示服务器 $s_j$ 的资源可用性，即一个二元组 $(s_{j,c}^a,s_{j,m}^a)$，其中 $s_{j,c}^a$ 表示服务器 $s_j$ 的 CPU 可用量，$s_{j,m}^a$ 表示服务器 $s_j$ 的内存可用量。我们用 $(s_{j,c}^k,s_{j,m}^k)$ 表示服务器 $s_j$ 的成本，即一个二元组 $(s_{j,c}^k,s_{j,m}^k)$，其中 $s_{j,c}^k$ 表示服务器 $s_j$ 的 CPU 单位成本，$s_{j,m}^k$ 表示服务器 $s_j$ 的内存单位成本。我们用 $s_j^h$ 表示服务器 $s_j$ 的收益，即服务器 $s_j$ 从任务卸载中获得的总金额。我们用 $s_j^g$ 表示服务器 $s_j$ 的效用，即服务器 $s_j$ 的收益减去服务器 $s_j$ 的成本。我们用 $v_i^l$ 表示车辆 $v_i$ 的效用，即车辆 $v_i$ 从任务卸载中获得的服务质量。我们用 $v_i^w$ 表示车辆 $v_i$ 的信道条件，即一个介于 0 到 1 之间的实数，表示车辆 $v_i$ 与服务器之间的通信质量。我们用 $(v_{i,x},v_{i,y})$ 表示车辆 $v_i$ 的位置，即一个二元组 $(v_{i,x},v_{i,y})$，表示车辆 $v_i$ 在地图上的坐标。我们用 $(v_{i,x}^y,v_{i,y}^y)$ 表示车辆 $v_i$ 的速度，即一个二元组 $(v_{i,x}^y,v_{i,y}^y)$，表示车辆 $v_i$ 在 x 轴和 y 轴上的速度分量。我们用 $(v_{i,x}^z,v_{i,y}^z)$ 表示车辆 $v_i$ 的加速度，即一个二元组 $(v_{i,x}^z,v_{i,y}^z)$，表示车辆 $v_i$ 在 x 轴和 y 轴上的加速度分量。
基于上述的符号和变量，我们可以将车联网任务卸载的问题建模为一个多智能体强化学习和反向拍卖的问题，如图 2 所示。在该问题中，每个智能体代表一个边缘服务器，它可以接收车辆的任务卸载请求，并利用其自身资源来完成任务卸载和获得收益。每个时间步骤中，有一个或多个车辆向满足其连接限制的服务器集合发送任务卸载请求，并等待服务器返回报价。环境会按照任务请求的连接限制，依次选择一个服务器作为当前回合的行动者，它可以根据自身在当前时间段内的资源使用情况和任务特征，以及报价策略，计算出自己对任务的报价，然后将报价发送给车辆。车辆会根据自己的预算和效用，选择一个报价最低的服务器进行卸载.

![多智能体强化学习和反向拍卖的示意图] 图 2 多智能体强化学习和反向拍卖的示意图。

每个智能体代表一个边缘服务器，它可以接收车辆的任务卸载请求，并利用其自身资源来完成任务卸载和获得收益。每个时间步骤中，有一个或多个车辆向满足其连接限制的服务器集合发送任务卸载请求，并等待服务器返回报价。环境会按照任务请求的连接限制，依次选择一个服务器作为当前回合的行动者，它可以根据自身在当前时间段内的资源使用情况和任务特征，以及报价策略，计算出自己对任务的报价，然后将报价发送给车辆。车辆会根据自己的预算和效用，选择一个报价最低的服务器作为任务的执行者，并与之建立连接。服务器会根据任务的资源需求，分配自己的资源，并执行任务。服务器会根据任务的执行结果，获得相应的收益，并更新自己的报价策略。车辆会根据任务的服务质量，获得相应的效用，并支付相应的费用。


### 多智能体强化学习和反向拍卖的基本概念和算法

多智能体强化学习是一种让多个智能体在一个共享的环境中通过交互学习和优化自己的行为的方法。每个智能体都有自己的状态空间、行动空间和奖励函数，它们可以根据自己的观察和历史经验，选择一个行动，然后从环境中获得一个反馈，即下一个状态和奖励。每个智能体的目标是最大化自己的累积奖励，即效用。多智能体强化学习的难点在于，每个智能体的行动会影响其他智能体的状态和奖励，从而导致环境的不确定性和非平稳性。因此，每个智能体需要考虑其他智能体的行为和策略，以及自己对其他智能体的影响，从而做出最优的决策。
反向拍卖是一种经济机制，用于解决多个买方和一个卖方之间的资源分配问题。在反向拍卖中，卖方是任务的执行者，它可以根据自己的成本和收益，对任务提出一个报价，即任务的执行费用。买方是任务的发起者，它可以根据自己的预算和效用，选择一个报价最低的卖方，即任务的执行者，并与之达成一个协议，即任务的分配。反向拍卖的目标是实现社会福利最大化，即买方和卖方的效用之和最大化。反向拍卖的难点在于，每个卖方都是自利的，它会根据自己的私有信息，即成本和收益，以及其他卖方的报价，来确定自己的报价，从而最大化自己的效用。因此，每个卖方需要考虑其他卖方的行为和策略，以及自己对其他卖方的影响，从而做出最优的报价。
为了解决车联网任务卸载的问题，我们采用了一种结合多智能体强化学习和反向拍卖的方法，如算法 1 所示。我们的方法主要包括以下几个步骤：
- 初始化：我们初始化每个服务器的资源向量、资源利用率、资源可用性、成本、收益和效用，以及每个车辆的位置、速度、加速度、信道条件、效用和预算。我们还初始化每个服务器的报价策略，即一个深度神经网络，它可以根据服务器的状态和任务的特征，输出一个报价。我们用 $\theta_j$ 表示服务器 $s_j$ 的报价策略的参数，用 $\pi_j(\theta_j)$ 表示服务器 $s_j$ 的报价策略的函数。
- 循环：我们循环执行以下步骤，直到仿真结束：
    - 任务到达：我们根据任务到达的概率分布，生成一个或多个任务，并将它们分配给相应的车辆。我们根据任务的特征，生成任务的资源需求、连接限制、优先级和预算。
    - 任务卸载请求：每个车辆根据自己的任务，向满足其连接限制的服务器集合发送任务卸载请求，并等待服务器返回报价。
    - 服务器选择：环境会按照任务请求的连接限制，依次选择一个服务器作为当前回合的行动者，它可以根据自身在当前时间段内的资源使用情况和任务特征，以及报价策略，计算出自己对任务的报价，然后将报价发送给车辆。我们用 $a_j$ 表示服务器 $s_j$ 的行动，即报价，用 $A_j$ 表示服务器 $s_j$ 的行动空间，即报价空间。
    - 任务分配：每个车辆根据自己的预算和效用，选择一个报价最低的服务器作为任务的执行者，并与之建立连接。我们用 $r_i^s$ 表示第 $i$ 个任务的执行者，即服务器 $s_i$。如果没有任何服务器满足车辆的预算和效用，车辆会选择在本地执行任务。
    - 任务执行：每个服务器根据任务的资源需求，分配自己的资源，并执行任务。我们用 $s_j^u$ 表示服务器 $s_j$ 的资源利用率，即一个二元组 $(s_{j,c}^u,s_{j,m}^u)$，其中 $s_{j,c}^u$ 表示服务器 $s_j$ 的 CPU 利用率，$s_{j,m}^u$ 表示服务器 $s_j$ 的内存利用率。我们用 $s_j^a$ 表示服务器 $s_j$ 的资源可用性，即一个二元组 $(s_{j,c}^a,s_{j,m}^a)$，其中 $s_{j,c}^a$ 表示服务器 $s_j$ 的 CPU 可用量，$s_{j,m}^a$ 表示服务器 $s_j$ 的内存可用量。我们用 $s_j^k$ 表示服务器 $s_j$ 的成本，即一个二元组 $(s_{j,c}^k,s_{j,m}^k)$，其中 $s_{j,c}^k$ 表示服务器 $s_j$ 的 CPU 单位成本，$s_{j,m}^k$ 表示服务器 $s_j$ 的内存单位成本。
    - 任务完成：每个服务器根据任务的执行结果，获得相应的收益，并更新自己的报价策略。我们用 $s_j^h$ 表示服务器 $s_j$ 的收益，即服务器 $s_j$ 从任务卸载中获得的总金额。我们用 $s_j^g$ 表示服务器 $s_j$ 的效用，即服务器 $s_j$ 的收益减去服务器 $s_j$ 的成本。我们用 $\nabla_{\theta_j} s_j^g$ 表示服务器 $s_j$ 的效用对其报价策略参数的梯度，即 $\nabla_{\theta_j} s_j^g = \frac{\partial s_j^g}{\partial \theta_j}$。我们用 $\alpha_j$ 表示服务器 $s_j$ 的学习率，即一个介于 0 到 1 之间的实数，表示服务器 $s_j$ 更新其报价策略参数的速度。我们用 $\theta_j' = \theta_j + \alpha_j \nabla_{\theta_j} s_j^g$ 表示服务器 $s_j$ 更新后的报价策略参数，即 $\theta_j' = \theta_j + \alpha_j \frac{\partial s_j^g}{\partial \theta_j}$。
    - 任务评价：每个车辆根据任务的服务质量，获得相应的



任务评价是指每个车辆根据任务的服务质量，获得相应的效用，并支付相应的费用。我们用 $v_i^l$ 表示车辆 $v_i$ 的效用，即车辆 $v_i$ 从任务卸载中获得的服务质量。我们用 $v_i^f$ 表示车辆 $v_i$ 的费用，即车辆 $v_i$ 为任务卸载支付的金额。我们假设车辆的效用和费用都是与任务的执行时间成反比的，即任务的执行时间越短，车辆的效用越高，费用越低。我们用 $r_i^e$ 表示第 $i$ 个任务的执行时间，即任务 $r_i$ 从开始到结束所花费的时间。我们用 $r_i^l$ 表示第 $i$ 个任务的最大执行时间，即任务 $r_i$ 的截止时间。我们用 $r_i^f$ 表示第 $i$ 个任务的最大费用，即任务 $r_i$ 的预算。我们用 $r_i^q$ 表示第 $i$ 个任务的服务质量，即任务 $r_i$ 的执行结果的准确性和可靠性。我们用 $r_i^a$ 表示第 $i$ 个任务的报价，即任务 $r_i$ 的执行者对任务 $r_i$ 的报价。我们用 $r_i^s$ 表示第 $i$ 个任务的执行者，即服务器 $s_i$。我们用 $r_i^v$ 表示第 $i$ 个任务的发起者，即车辆 $v_i$。我们用 $v_i^w$ 表示车辆 $v_i$ 的信道条件，即一个介于 0 到 1 之间的实数，表示车辆 $v_i$ 与服务器之间的通信质量。我们用 $\beta$ 表示一个介于 0 到 1 之间的实数，表示任务的服务质量对车辆的效用的影响程度。我们用 $\gamma$ 表示一个介于 0 到 1 之间的实数，表示任务的报价对车辆的效用的影响程度。我们用 $\delta$ 表示一个介于 0 到 1 之间的实数，表示任务的执行时间对车辆的效用的影响程度。我们用 $\eta$ 表示一个介于 0 到 1 之间的实数，表示任务的执行时间对车辆的费用的影响程度。我们用 $\phi$ 表示一个介于 0 到 1 之间的实数，表示任务的报价对车辆的费用的影响程度。我们用 $\psi$ 表示一个介于 0 到 1 之间的实数，表示任务的服务质量对车辆的费用的影响程度。
基于上述的符号和变量，我们可以定义车辆的效用和费用的计算公式如下：
$$
v_i^l = \beta r_i^q + \gamma (1 - r_i^a) + \delta (1 - \frac{r_i^e}{r_i^l})
$$
$$
v_i^f = \eta \frac{r_i^e}{r_i^l} + \phi r_i^a + \psi (1 - r_i^q)
$$
其中，$v_i^l$ 和 $v_i^f$ 都是介于 0 到 1 之间的实数，表示车辆 $v_i$ 的效用和费用的归一化值。我们假设车辆的效用和费用都是与任务的服务质量、报价和执行时间成正比或者反比的，即任务的服务质量越高，报价越低，执行时间越短，车辆的效用越高，费用越低。我们还假设车辆的效用和费用都受到信道条件的影响，即信道条件越好，车辆的效用越高，费用越低。因此，我们可以将车辆的效用和费用的计算公式修改为如下：
$$
v_i^l = v_i^w (\beta r_i^q + \gamma (1 - r_i^a) + \delta (1 - \frac{r_i^e}{r_i^l}))
$$
$$
v_i^f = v_i^w (\eta \frac{r_i^e}{r_i^l} + \phi r_i^a + \psi (1 - r_i^q))
$$
在每个时间步骤中，每个车辆都会根据自己的任务，向满足其连接限制的服务器集合发送任务卸载请求，并等待服务器返回报价。然后，每个车辆都会根据自己的预算和效用，选择一个报价最低的服务器作为任务的执行者，并与之建立连接。如果没有任何服务器满足车辆的预算和效用，车辆会选择在本地执行任务。在任务执行完成后，每个车辆都会根据任务的服务质量，获得相应的效用，并支付相应的费用。我们用 $v_i^l$ 表示车辆 $v_i$ 的效用，用 $v_i^f$ 表示车辆 $v_i$ 的费用。我们用 $s_j^h$ 表示服务器 $s_j$ 的收益，即服务器 $s_j$ 从任务卸载中获得的总金额。我们用 $s_j^g$ 表示服务器 $s_j$ 的效用，即服务器 $s_j$ 的收益减去服务器 $s_j$ 的成本。我们用 $s_j^k$ 表示服务器 $s_j$ 的成本，即一个二元组 $(s_{j,c}^k,s_{j,m}^k)$，其中 $s_{j,c}^k$ 表示服务器 $s_j$ 的 CPU 单位成本，$s_{j,m}^k$ 表示服务器 $s_j$ 的内存单位成本。我们用 $r_i^a$ 表示第 $i$ 个任务的报价，即任务 $r_i$ 的执行者对任务 $r_i$ 的报价。我们用 $r_i^s$ 表示第 $i$ 个任务的执行者，即服务器 $s_i$。我们用 $r_i^v$ 表示第 $i$ 个任务的发起者，即车辆 $v_i$。我们用 $r_i^c$ 表示第 $i$ 个任务的资源需求，即一个二元组 $(r_{i,c},r_{i,m})$，其中 $r_{i,c}$ 表示任务 $r_i$ 的 CPU 需求，$r_{i,m}$ 表示任务 $r_i$ 的内存需求。
基于上述的符号和变量，我们可以定义服务器的收益、成本和效用的计算公式如下：
$$
s_j^h = \sum_{i=1}^R r_i^a \mathbb{I}(r_i^s = s_j)
$$
$$
s_j^k = \sum_{i=1}^R (s_{j,c}^k r_{i,c} + s_{j,m}^k r_{i,m}) \mathbb{I}(r_i^s = s_j)
$$
$$
s_j^g = s_j^h - s_j^k
$$
其中，$\mathbb{I}(r_i^s = s_j)$ 是一个指示函数，当 $r_i^s = s_j$ 时，它的值为 1，否则为 0。我们假设服务器的收益和成本都是与任务的报价和资源需求成正比的，即任务的报价越高，资源需求越大，服务器的收

---



## 问题的建模和方法的设计

本节主要介绍了本文提出的基于多智能体强化学习和反向拍卖机制的车联网任务卸载方法（RATO）的问题建模和方法设计，包括系统模型、优化目标、决策方法和算法流程等。
系统模型本文考虑了一个由N个车辆和M个边缘服务器组成的车联网系统，如图2所示。每个车辆都有一个或多个计算任务需要执行，每个边缘服务器都有一定的计算资源可以提供给车辆进行任务卸载。车辆和边缘服务器之间通过无线通信进行数据传输，如IEEE 802.11p和LTE等。车辆和边缘服务器之间的通信质量取决于车辆的移动性、距离、信道等因素。本文假设车辆和边缘服务器之间的通信是可靠的，即不考虑数据丢包和错误的情况。
本文采用了以下的符号和定义：
- $V={v_1,v_2,...,v_N}$表示车辆的集合，$N$表示车辆的数量。
- $S={s_1,s_2,...,s_M}$表示边缘服务器的集合，$M$表示边缘服务器的数量。
- $T={t_1,t_2,...,t_K}$表示计算任务的集合，$K$表示计算任务的数量。
- $t_i=(p_i,d_i,c_i,m_i,l_i)$表示第$i$个计算任务的属性，其中$p_i$表示任务的优先级，$d_i$表示任务的截止时间，$c_i$表示任务的计算量，$m_i$表示任务的内存需求，$l_i$表示任务的连接限制，即任务可以向满足信道条件的$l_i$个服务器发送任务卸载请求。
- $r_j=(f_j,n_j)$表示第$j$个边缘服务器的资源，其中$f_j$表示服务器的计算能力，$n_j$表示服务器的内存容量。
- $h_{ij}$表示第$i$个车辆和第$j$个边缘服务器之间的信道增益，反映了通信质量的好坏。
- $b_i$表示第$i$个车辆的任务卸载预算，即车辆愿意为任务卸载支付的最大金额。
- $q_{ij}$表示第$j$个边缘服务器对第$i$个车辆的任务卸载请求的报价，即服务器要求车辆为任务卸载支付的金额。
- $x_{ij}$表示第$i$个车辆是否将任务卸载给第$j$个边缘服务器的决策变量，如果是，则$x_{ij}=1$，否则，$x_{ij}=0$。
- $y_{ij}$表示第$j$个边缘服务器是否接受第$i$个车辆的任务卸载请求的决策变量，如果是，则$y_{ij}=1$，否则，$y_{ij}=0$。
- $z_{ij}$表示第$i$个车辆和第$j$个边缘服务器之间是否发生任务卸载的结果变量，如果是，则$z_{ij}=1$，否则，$z_{ij}=0$。显然，$z_{ij}=x_{ij}y_{ij}$。
- $u_i$表示第$i$个车辆的效用，即车辆在任务卸载过程中获得的总效用，包括任务执行的效用和任务卸载的效用。任务执行的效用是指任务执行的效率和质量，如任务完成率、任务时延等。任务卸载的效用是指任务卸载的收入和支出，如任务报价、任务成本等。
- $e_j$表示第$j$个边缘服务器的收益，即服务器在任务卸载过程中获得的总收益，包括任务执行的收益和任务卸载的收益。任务执行的收益是指任务执行的效用和价值，如任务完成率、任务质量等。任务卸载的收益是指任务卸载的收入和支出，如任务报价、任务成本等。
优化目标本文的优化目标是最大化车辆的效用和边缘服务器的收益，同时保证任务的完成率和质量。具体地，本文定义了以下的优化目标函数：
- 车辆的效用最大化：
$$\max_{x_{ij}} \sum_{i=1}^N u_i=\sum_{i=1}^N \sum_{j=1}^M z_{ij}(u_{ij}^e-u_{ij}^c)$$
其中，$u_{ij}^e$表示第$i$个车辆将任务卸载给第$j$个边缘服务器后的任务执行效用，$u_{ij}^c$表示第$i$个车辆将任务卸载给第$j$个边缘服务器后的任务卸载成本。任务执行效用和任务卸载成本的具体计算方法将在后文给出。
- 边缘服务器的收益最大化：
$$\max_{y_{ij}} \sum_{j=1}^M e_j=\sum_{j=1}^M \sum_{i=1}^N z_{ij}(e_{ij}^e+e_{ij}^c)$$
其中，$e_{ij}^e$表示第$j$个边缘服务器接受第$i$个车辆的任务卸载请求后的任务执行收益，$e_{ij}^c$表示第$j$个边缘服务器接受第$i$个车辆的任务卸载请求后的任务卸载收入。任务执行收益和任务卸载收入的具体计算方法将在后文给出。
- 任务的完成率和质量保证：
$$\sum_{i=1}^N \sum_{j=1}^M z_{ij} \geq \alpha K$$
$$\sum_{i=1}^N \sum_{j=1}^M z_{ij} t_i \leq \beta \sum_{i=1}^N t_i$$
其中，$\alpha$和$\beta$是两个给定的常数，分别表示任务的完成率和任务的平均时延的阈值。任务的完成率是指成功卸载并执行的任务占总任务的比例，任务的平均时延是指所有任务的卸载时延的平均值，卸载时延是指从任务生成到任务完成的总时间。这两个约束条件的目的是为了保证任务卸载的效果和质量，避免任务的丢失和延迟。
决策方法本文采用了基于多智能体强化学习和反向拍卖机制的决策方法，即让每个边缘服务器作为一个智能体，利用强化学习算法学习最优或次优的报价策略，即如何根据任务的需求、紧急性和自身的资源等约束，动态地决定每次报价的金额，从而最大化服务器的收益和车辆的效用。同时，让每个车辆作为一个拍卖者，利用反向拍卖机制选择最优或次优的卸载策略，即如何根据任务的连接限制和预算条件，选择选择满足其连接限制和预算条件的服务器进行任务卸载，从而提高任务的完成率和质量。
本文采用了一种基于PPO（Proximal Policy Optimization）算法的多智能体强化学习方法，来训练边缘服务器的报价策略。PPO是一种基于策略梯度的强化学习算法，它通过优化一个目标函数，来更新策略网络的参数，从而提高策略的性能。PPO的目标函数是一个带有剪裁的比率函数，它可以有效地防止策略的更新幅度过大，导致策略的崩溃或震荡。PPO的目标函数如下：
$$L(\theta)=\mathbb{E}{s,a,r}\left[\min\left(\frac{\pi{\theta}(a|s)}{\pi_{\theta_{\text{old}}}(a|s)}A^{\pi_{\theta_{\text{old}}}}(s,a),\text{clip}\left(\frac{\pi_{\theta}(a|s)}{\pi_{\theta_{\text{old}}}(a|s)},1-\epsilon,1+\epsilon\right)A^{\pi_{\theta_{\text{old}}}}(s,a)\right)\right]$$
其中，$\theta$表示策略网络的参数，$\theta_{\text{old}}$表示上一次更新后的策略网络的参数，$\pi_{\theta}(a|s)$表示策略网络输出的在状态$s$下采取动作$a$的概率，$A^{\pi_{\theta_{\text{old}}}}(s,a)$表示在状态$s$下采取动作$a$的优势函数，即动作的价值与状态的价值之差，$\epsilon$表示剪裁的阈值，通常取0.1或0.2。
本文将边缘服务器的报价策略建模为一个部分可观测马尔可夫决策过程（Partially Observable Markov Decision Process，POMDP），其中，每个边缘服务器作为一个智能体，需要根据自身的观察和历史信息，做出每次报价的决策。本文定义了以下的POMDP元素：
- 状态空间$S$。状态空间表示边缘服务器的观察空间，即边缘服务器可以观察到的信息，包括自身的资源状况、任务的特征、车辆的预算等。本文将状态空间定义为一个连续的向量空间，即$S=\mathbb{R}^n$，其中$n$表示状态向量的维度。
- 动作空间$A$。动作空间表示边缘服务器的报价空间，即边缘服务器可以对任务卸载请求提出的报价，包括固定报价、随机报价、学习报价等。本文将动作空间定义为一个连续的标量空间，即$A=\mathbb{R}$，其中报价的取值范围为$[0,b_i]$，即不能超过车辆的预算。
- 转移函数$T$。转移函数表示边缘服务器的状态在不同时间步之间的转移概率，即在当前状态和动作下，下一个状态出现的概率，即$T:S\times A\times S\rightarrow [0,1]$。本文假设转移函数是未知的，即边缘服务器无法预测下一个状态的出现，只能通过与环境的交互来学习。
- 奖励函数$R$。奖励函数表示边缘服务器在不同状态和动作下获得的即时奖励，即在当前状态和动作下，边缘服务器的收益，即$R:S\times A\rightarrow \mathbb{R}$。本文将奖励函数定义为边缘服务器的收益，即$R(s,a)=e_j$，其中$e_j$是第$j$个边缘服务器的收益，具体计算方法将在后文给出。
- 策略函数$\pi$。策略函数表示边缘服务器在不同状态下采取不同动作的概率分布，即在当前状态下，每个动作被选择的概率，即$\pi:A\times S\rightarrow [0,1]$。本文将策略函数定义为一个神经网络，即$\pi_{\theta}(a|s)$，其中$\theta$表示神经网络的参数，$a$表示动作，$s$表示状态。本文的目标是通过强化学习算法，优化神经网络的参数，从而得到最优或次优的策略函数。
本文采用了一种基于反向拍卖机制的任务卸载方法，即让每个车辆作为一个拍卖者，利用反向拍卖机制选择最优或次优的卸载策略，即如何根据任务的连接限制和预算条件，选择满足其连接限制和预算条件的服务器进行任务卸载，从而提高任务的完成率和质量。反向拍卖机制是一种常用的资源分配机制，它与正向拍卖机制相反，即由多个卖方（边缘服务器）对一个买方（车辆）的需求进行竞价，买方选择报价最低的卖方进行交易。反向拍卖机制的优点是可以有效地降低买方的成本，提高卖方的竞争力，实现资源的高效分配和利用。反向拍卖机制的过程如下：
- 每个车辆根据自身的任务特征和预算，向满足其连接限制的边缘服务器发送任务卸载请求，即$x_{ij}=1$，其中$j\in L_i$，$L_i$表示第$i$个车辆的连接限制集合，即满足信道条件的服务器集合。
- 每个边缘服务器根据自身的资源状况和报价策略，对收到的任务卸载请求进行报价，即$q_{ij}$，其中$i\in R_j$，$R_j$表示第$j$个边缘服务器的请求集合，即向其发送任务卸载请求的车辆集合。
- 每个车辆根据收到的报价，选择一个或多个报价最低、同时满足需求和预算条件的边缘服务器进行交易，即$y_{ij}=1$，其中$j\in W_i$，$W_i$表示第$i$个车辆的胜出者集合，即被其选择进行任务卸载的服务器集合。
- 交易成功后，车辆将任务发送到胜出者服务器并支付相应金额，等待执行结果返回，即$z_{ij}=1$，其中$j\in W_i$。服务器获得收益，为任务分配资源并执行任务卸载。如果没有服务器的报价满足车辆的条件，则车辆无法完成任务卸载，无需支付任何金额，即$z_{ij}=0$，其中$j\in L_i$。
算法流程本文提出了一种基于多智能体强化学习和反向拍卖机制的车联网任务卸载算法，简称为RATO算法。该算法的流程如算法1所示。该算法主要包括以下几个步骤：
- 初始化。初始化车辆和边缘服务器的集合，计算任务的集合，边缘服务器的策略网络的参数，以及其他相关的参数和变量。
- 循环。循环执行以下步骤，直到达到终止条件，如最大迭代次数或最小误差阈值等。
    - 任务生成。每个车辆根据自身的任务特征和预算，生成一个或多个计算任务，并将其添加到任务集合中。
    - 任务卸载请求。每个车辆根据自身的任务连接限制，向满足其连接限制的边缘服务器发送任务卸载请求，即$x_{ij}=1$，其中$j\in L_i$。
    - 任务卸载报价。每个边缘服务器根据自身的资源状况和策略网络的输出，对收到的任务卸载请求进行报价，即$q_{ij}=\pi_{\theta}(a|s)$，其中$i\in R_j$。
    - 任务卸载选择。每个车辆根据收到的报价，选择一个或多个报价最低、同时满足需求和预算条件的边缘服务器进行交易，即$y_{ij}=1$，其中$j\in W_i$。
    - 任务卸载执行。交易成功后，车辆将任务发送到胜出者服务器并支付相应金额，等待执行结果返回，即$z_{ij}=1$，其中$j\in W_i$。服务器获得收益，为任务分配资源并执行任务卸载。如果没有服务器的报价满足车辆的条件，则车辆无法完成任务卸载，无需支付任何金额，即$z_{ij}=0$，其中$j\in L_i$。
    - 状态更新。每个边缘服务器根据任务卸载的结果，更新自身的状态，如资源状况、任务队列等。
    - 奖励计算。每个边缘服务器根据任务卸载的结果，计算自身的奖励，即收益，如$R(s,a)=e_j$。
    - 经验存储。每个边缘服务器将自身的经验，即状态、动作、奖励和下一个状态，存储到自身的经验回放缓冲区中，用于后续的策略更新。
    - 策略更新。每隔一定的时间步，每个边缘服务器从自身的经验回放缓冲区中随机抽取一批经验，利用PPO算法更新自身的策略网络的参数，从而提高自身的策略性能。
- 输出。输出车辆和边缘服务器的最终的效用和收益，以及任务的完成率和质量等指标。
算法1：基于多智能体强化学习和反向拍卖机制的车联网任务卸载算法（RATO）
本文的第三节问题的建模和方法的设计到此结束。
